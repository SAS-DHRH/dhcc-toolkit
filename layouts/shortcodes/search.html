<!-- Lunr.js script -->
<script src="https://unpkg.com/lunr/lunr.js"></script>

<!-- Search UI -->
<input id="search" type="text" placeholder="Search the Toolkit..." style="width: 100%; padding: 0.5em; margin-bottom: 1em;">
<ul id="results" style="list-style: none; padding-left: 0;"></ul>

<script>
// Highlight function to wrap matching terms in <mark> tags
function highlight(text, words) {
  words.forEach(word => {
    const regex = new RegExp(`(${word})`, 'gi');
    text = text.replace(regex, '<mark>$1</mark>');
  });
  return text;
}

document.getElementById('search').addEventListener('input', function () {
  const query = this.value.trim();
  const resultsList = document.getElementById('results');
  resultsList.innerHTML = '';

  if (query.length < 2) return;

  // Split the search query into individual terms
  const terms = query.split(/\s+/);
  
  // Create fuzzy query by adding ~1 to each search term
  const fuzzyQuery = terms.map(term => `${term}~1`).join(' '); // ~1 for fuzzy search

  try {
    // Perform search using Lunr.js with fuzzy query
    const results = idx.search(fuzzyQuery);

    results.forEach(r => {
      const item = documents[r.ref];
      const highlightedTitle = highlight(item.title, terms);
      const highlightedSummary = highlight(item.summary, terms);

      // Create result item and append to the results list
      const li = document.createElement('li');
      li.innerHTML = `<a href="${item.url}"><strong>${highlightedTitle}</strong></a><br><small>${highlightedSummary}</small>`;
      resultsList.appendChild(li);
    });
  } catch (err) {
    console.warn('Search error:', err);
  }
});
</script>